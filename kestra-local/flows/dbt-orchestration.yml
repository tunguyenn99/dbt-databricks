id: hr.dbt_flow
namespace: dbt_workspace

tasks:
  - id: dbt_build
    type: io.kestra.plugin.scripts.python.Script
    runner: DOCKER
    docker:
      image: ghcr.io/kestra-io/pykestra:3.11  # image c√≥ s·∫µn DBT
    env:
      DBT_PROFILES_DIR: /app/dbt  # ƒëi·ªÅu ch·ªânh n·∫øu b·∫°n d√πng profile kh√°c
    inputs:
      - name: DBT_PROJECT_DIR
        type: STRING
    commands:
      - cd {{ inputs.DBT_PROJECT_DIR }}
      - dbt deps
      - dbt build --target dev

  - id: notify_success
    type: io.kestra.plugin.notifications.slack.SlackIncomingWebhook
    url: "<your-slack-webhook-url>"
    message: "‚úÖ DBT Flow Completed Successfully üéâ"

errors:
  - id: notify_failure
    type: io.kestra.plugin.notifications.slack.SlackIncomingWebhook
    url: "<your-slack-webhook-url>"
    message: "‚ùå DBT Flow Failed! Check logs!"
